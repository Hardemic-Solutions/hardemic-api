<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CDN dos icones usados -->
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-solid-rounded/css/uicons-solid-rounded.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-regular-straight/css/uicons-regular-straight.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-bold-rounded/css/uicons-bold-rounded.css'>
  <!-- arquivos para estilização do html -->
  <link rel="stylesheet" href="./css/global.css">
  <link rel="stylesheet" href="./css/config.css">
  <!-- arquivos js -->
  <script src="js/global.js"></script>
  <!-- nome e icone do documento -->
  <link rel="shortcut icon" href="./assets/brain.jpg" type="image/x-icon">
  <title>Configurações | Hardemic Solutions</title>

</head>

<body>
  <div class="box_all">

    <div class="navegation_bar">
      <div onclick="goToDevices()" class="box_bar">
        <a>Devices</a>
        <i class="fi fi-rr-screen"></i>
      </div>
      <!-- <div onclick="goToDash()" class="box_bar">
        <a>Dash</a>
        <i class="fi fi-rr-stats"></i>
      </div> -->
      <div onclick="goToTickets()" class="box_bar">
        <a>Tickets</a>
        <i class="fi fi-rr-ticket"></i>
      </div>
      <div onclick="goToRotinas()" class="box_bar">
        <a>Rotinas</a>
        <i class="fi fi-rr-calendar"></i>
      </div>
      <div onclick="goToConfig()" class="box_bar">
        <a>Configurações</a>
        <i class="fi fi-rr-settings"></i>
      </div>
    </div>

    <div class="box_chart">
      <div class="header_bar">
        <div class="container_left">

        </div>
        <div class="container_right">
          <i onclick="meuPerfil()" class="fi fi-sr-user"></i>
          <i onclick="exit()" class="fi fi-rr-sign-out"></i>
        </div>
      </div>
      <div class="tittle_devices">
        <h1>
          Configurações
        </h1>
      </div>
      <div class="box_dashboard">
        <div class="subtitles">

          <h2>Notificações</h2>

          <h2>Recursos monitorados</h2>

        </div>

        <div style="display: flex; flex-direction: row; justify-content: space-around;">

          <div class="container_options">

            <div class="container_toogle">
              <span>
                <h3>Alertas de recursos</h3>
              </span>

              <div class="container toogle">
                <div class="button r button-toogle">
                  <input type="checkbox" class="checkbox" id="alerta_recursos" />
                  <div class="knobs"></div>
                  <div class="layer"></div>
                </div>
              </div>
            </div>

            <div class="container_toogle">
              <h3>Tickets novos</h3>
              <div class="container toogle">
                <div class="button r button-toogle">
                  <input type="checkbox" class="checkbox" id="alerta_tickets_novos" />
                  <div class="knobs"></div>
                  <div class="layer"></div>
                </div>
              </div>
            </div>

            <div class="container_toogle">
              <h3>Lembrete de tickets pendentes</h3>
              <div class="container toogle">
                <div class="button r button-toogle">
                  <input type="checkbox" class="checkbox" id="alerta_tickets_pendentes" />
                  <div class="knobs"></div>
                  <div class="layer"></div>
                </div>
              </div>
            </div>

            <div class="container_toogle">
              <h3>Rotina baixada</h3>
              <div class="container toogle">
                <div class="button r button-toogle">
                  <input type="checkbox" class="checkbox" id="alerta_rotina" />
                  <div class="knobs"></div>
                  <div class="layer"></div>
                </div>
              </div>
            </div>

          </div>

          <!-- Segunda section -->

          <div class="container_options">

            <div class="container_toogle">
              <h3>CPU</h3>
              <div>


                <div class="container_metrica">
                  <label for="valor_cpu">Valor</label>
                  <input id="valor_cpu" max="100" type="number" placeholder="Métrica">
                </div>

                <div class="container toogle">
                  <div class="button r button-toogle">
                    <input id="checkbox_cpu" type="checkbox" class="checkbox" />
                    <div class="knobs"></div>
                    <div class="layer"></div>
                  </div>
                </div>
              </div>
            </div>


            <div class="container_toogle">
              <h3>RAM</h3>
              <div>

                <div class="container_metrica">
                  <label for="valor_ram">Valor</label>
                  <input id="valor_ram" type="number" placeholder="Métrica">
                </div>


                <div class="container toogle">
                  <div class="button r button-toogle">
                    <input id="checkbox_ram" type="checkbox" class="checkbox" />
                    <div class="knobs"></div>
                    <div class="layer"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="container_toogle">
              <h3>Disco</h3>
              <div>


                <div class="container_metrica">
                  <label for="valor_disco">Valor</label>
                  <input id="valor_disco" type="number" placeholder="Métrica">
                </div>

                <div class="container toogle">
                  <div class="button r button-toogle">
                    <input id="checkbox_disco" type="checkbox" class="checkbox" />
                    <div class="knobs"></div>
                    <div class="layer"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="container_toogle">
              <h3>GPU</h3>
              <div>
                <div class="container_metrica">
                  <label for="valor_gpu">Valor</label>
                  <input id="valor_gpu" type="number" placeholder="Métrica">
                </div>

                <div class="container toogle">
                  <div class="button r button-toogle">
                    <input id="checkbox_gpu" type="checkbox" class="checkbox" />
                    <div class="knobs"></div>
                    <div class="layer"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="container_toogle">
              <h3>Temperatura</h3>
              <div>
                <div class="container_metrica">
                  <label for="valor_temp">Valor</label>
                  <input id="valor_temp" type="number" placeholder="Métrica">
                </div>

                <div class="container toogle">
                  <div class="button r button-toogle">
                    <input id="checkbox_temp" type="checkbox" class="checkbox" />
                    <div class="knobs"></div>
                    <div class="layer"></div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>
<script>
  window.onload = () => {
    (() => {
      fetch(`/empresa/${sessionStorage.ID_EMPRESA}/config`, {
        method: 'GET'
      }).then(response => {
        response.json().then(json => {
          console.log(json)
          json.forEach(config => {
            let check = document.getElementById(`checkbox_${config.nome_config.split('_').at(-1)}`)
            let input = document.getElementById(`valor_${config.nome_config.split('_').at(-1)}`)

            if (check) {
              check.checked = config.situacao;
              input.value = config.valor;
              check.oninput = () => debounceUpdate(config.id_config, input.value, check.checked)
              input.oninput = () => debounceUpdate(config.id_config, input.value, check.checked)
            }
          });
        })
      })
    })()
  }

  const debounce = (func, wait) => {
    let timeout;

    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };

      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  };

  const debounceUpdate = debounce(update, 1000)

  function update(idConfig, value, situacao) {
    fetch(`/empresa/${sessionStorage.ID_EMPRESA}/config/${idConfig}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        valor: +value,
        situacao: +situacao
      })
    }).then(res => {
      if (res.ok) {
        alert("Atualizado com sucesso")
      }
    }).catch(err => console.error('Erro ao atualizar configuração', err))
  }
</script>